{% extends 'base.html' %}
{% load static %}

{% block title %}
{% if object %}Editar Proveedor{% else %}Nuevo Proveedor{% endif %} - Compras
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0">
                {% if object %}
                    Editar Proveedor: {{ object.razon_social }}
                {% else %}
                    Nuevo Proveedor
                {% endif %}
            </h1>
            <p class="text-muted mb-0">
                {% if object %}
                    Actualizar información del proveedor
                {% else %}
                    Registrar nuevo proveedor en el sistema
                {% endif %}
            </p>
        </div>
        <a href="{% url 'compras:proveedor_list' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i> Volver
        </a>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <form method="post" novalidate>
                {% csrf_token %}
                
                <!-- Información Básica -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-building me-2 text-primary"></i>
                            Información Básica
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="{{ form.codigo.id_for_label }}" class="form-label">
                                    Código
                                    {% if not form.codigo.value %}
                                        <small class="text-muted">(Automático)</small>
                                    {% endif %}
                                </label>
                                {{ form.codigo }}
                                {% if form.codigo.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.codigo.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                {% if form.codigo.help_text %}
                                    <small class="form-text text-muted">{{ form.codigo.help_text }}</small>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-8">
                                <label for="{{ form.razon_social.id_for_label }}" class="form-label">
                                    Razón Social <span class="text-danger">*</span>
                                </label>
                                {{ form.razon_social }}
                                {% if form.razon_social.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.razon_social.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-8">
                                <label for="{{ form.nombre_comercial.id_for_label }}" class="form-label">
                                    Nombre Comercial
                                </label>
                                {{ form.nombre_comercial }}
                                {% if form.nombre_comercial.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.nombre_comercial.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-4">
                                {% if object %}
                                <div class="form-check">
                                    {{ form.activo }}
                                    <label class="form-check-label" for="{{ form.activo.id_for_label }}">
                                        Proveedor activo
                                    </label>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Identificación -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-id-card me-2 text-primary"></i>
                            Identificación
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="{{ form.tipo_documento.id_for_label }}" class="form-label">
                                    Tipo de Documento <span class="text-danger">*</span>
                                </label>
                                {{ form.tipo_documento }}
                                {% if form.tipo_documento.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.tipo_documento.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-8">
                                <label for="{{ form.numero_documento.id_for_label }}" class="form-label">
                                    Número de Documento <span class="text-danger">*</span>
                                </label>
                                {{ form.numero_documento }}
                                {% if form.numero_documento.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.numero_documento.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contacto -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-phone me-2 text-primary"></i>
                            Información de Contacto
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="{{ form.telefono.id_for_label }}" class="form-label">
                                    Teléfono <span class="text-danger">*</span>
                                </label>
                                {{ form.telefono }}
                                {% if form.telefono.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.telefono.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6">
                                <label for="{{ form.email.id_for_label }}" class="form-label">
                                    Email <span class="text-danger">*</span>
                                </label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.email.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-12">
                                <label for="{{ form.sitio_web.id_for_label }}" class="form-label">
                                    Sitio Web
                                </label>
                                {{ form.sitio_web }}
                                {% if form.sitio_web.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.sitio_web.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ubicación -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-map-marker-alt me-2 text-primary"></i>
                            Ubicación
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="{{ form.direccion.id_for_label }}" class="form-label">
                                    Dirección
                                </label>
                                {{ form.direccion }}
                                {% if form.direccion.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.direccion.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-8">
                                <label for="{{ form.ciudad.id_for_label }}" class="form-label">
                                    Ciudad
                                </label>
                                {{ form.ciudad }}
                                {% if form.ciudad.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.ciudad.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-4">
                                <label for="{{ form.codigo_postal.id_for_label }}" class="form-label">
                                    Código Postal
                                </label>
                                {{ form.codigo_postal }}
                                {% if form.codigo_postal.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.codigo_postal.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Términos Comerciales -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-handshake me-2 text-primary"></i>
                            Términos Comerciales
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="{{ form.condiciones_pago.id_for_label }}" class="form-label">
                                    Condiciones de Pago
                                </label>
                                {{ form.condiciones_pago }}
                                {% if form.condiciones_pago.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.condiciones_pago.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-4">
                                <label for="{{ form.limite_credito.id_for_label }}" class="form-label">
                                    Límite de Crédito
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    {{ form.limite_credito }}
                                </div>
                                {% if form.limite_credito.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.limite_credito.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                {% if form.limite_credito.help_text %}
                                    <small class="form-text text-muted">{{ form.limite_credito.help_text }}</small>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-4">
                                <label for="{{ form.descuento_comercial.id_for_label }}" class="form-label">
                                    Descuento Comercial
                                </label>
                                <div class="input-group">
                                    {{ form.descuento_comercial }}
                                    <span class="input-group-text">%</span>
                                </div>
                                {% if form.descuento_comercial.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.descuento_comercial.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                {% if form.descuento_comercial.help_text %}
                                    <small class="form-text text-muted">{{ form.descuento_comercial.help_text }}</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contacto Principal -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-user me-2 text-primary"></i>
                            Contacto Principal
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="{{ form.contacto_nombre.id_for_label }}" class="form-label">
                                    Nombre del Contacto
                                </label>
                                {{ form.contacto_nombre }}
                                {% if form.contacto_nombre.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.contacto_nombre.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6">
                                <label for="{{ form.contacto_cargo.id_for_label }}" class="form-label">
                                    Cargo
                                </label>
                                {{ form.contacto_cargo }}
                                {% if form.contacto_cargo.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.contacto_cargo.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6">
                                <label for="{{ form.contacto_telefono.id_for_label }}" class="form-label">
                                    Teléfono del Contacto
                                </label>
                                {{ form.contacto_telefono }}
                                {% if form.contacto_telefono.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.contacto_telefono.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6">
                                <label for="{{ form.contacto_email.id_for_label }}" class="form-label">
                                    Email del Contacto
                                </label>
                                {{ form.contacto_email }}
                                {% if form.contacto_email.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.contacto_email.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Observaciones -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-sticky-note me-2 text-primary"></i>
                            Observaciones
                        </h5>
                    </div>
                    <div class="card-body">
                        {{ form.observaciones }}
                        {% if form.observaciones.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.observaciones.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Botones de Acción -->
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'compras:proveedor_list' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-1"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>
                                {% if object %}Actualizar Proveedor{% else %}Crear Proveedor{% endif %}
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Sidebar de ayuda -->
        <div class="col-lg-4">
            <div class="card sticky-top">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-info-circle me-1 text-info"></i>
                        Información de Ayuda
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6 class="text-primary">Campos Requeridos</h6>
                        <ul class="list-unstyled small">
                            <li><i class="fas fa-check text-success me-1"></i> Razón Social</li>
                            <li><i class="fas fa-check text-success me-1"></i> Tipo de Documento</li>
                            <li><i class="fas fa-check text-success me-1"></i> Número de Documento</li>
                            <li><i class="fas fa-check text-success me-1"></i> Teléfono</li>
                            <li><i class="fas fa-check text-success me-1"></i> Email</li>
                        </ul>
                    </div>
                    
                    <div class="mb-3">
                        <h6 class="text-primary">Consejos</h6>
                        <ul class="list-unstyled small text-muted">
                            <li>• El código se genera automáticamente si no se especifica</li>
                            <li>• El número de documento debe ser único</li>
                            <li>• El email debe ser único y válido</li>
                            <li>• El descuento comercial debe estar entre 0% y 100%</li>
                        </ul>
                    </div>
                    
                    {% if object %}
                    <div class="alert alert-info small mb-0">
                        <strong>Creado:</strong> {{ object.fecha_creacion|date:"d/m/Y H:i" }}<br>
                        <strong>Por:</strong> {{ object.usuario_creacion.get_full_name }}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Validación en tiempo real
    const form = document.querySelector('form');
    const requiredFields = form.querySelectorAll('input[required], select[required]');
    
    requiredFields.forEach(field => {
        field.addEventListener('blur', function() {
            if (this.value.trim() === '') {
                this.classList.add('is-invalid');
            } else {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            }
        });
    });
    
    // Formatear número de documento (solo números)
    const numeroDocumento = document.getElementById('{{ form.numero_documento.id_for_label }}');
    if (numeroDocumento) {
        numeroDocumento.addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
    }
    
    // Formatear teléfono
    const telefono = document.getElementById('{{ form.telefono.id_for_label }}');
    if (telefono) {
        telefono.addEventListener('input', function() {
            // Permitir números, espacios, guiones, paréntesis y +
            this.value = this.value.replace(/[^0-9\s\-\(\)\+]/g, '');
        });
    }
});
</script>
{% endblock %}